"use strict";(self.webpackChunktainacan=self.webpackChunktainacan||[]).push([[7352],{7352(e,t,n){n.r(t),n.d(t,{default:()=>o});var a=n(14911),i=n(66275);n(70811);const o=(0,n(66262).A)(i.A,[["render",a.X],["__scopeId","data-v-e83c1d70"]])},14911(e,t,n){n.d(t,{X:()=>a.X});var a=n(62354)},62354(e,t,n){n.d(t,{X:()=>X});var a=n(6934);function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}var r={key:1,class:"tainacan-form","label-width":"120px"},c={class:"label"},l={class:"drop-inner"},s={class:"content has-text-centered"},d={class:"document-list"},u={class:"sequence-progress-info"},p={key:0},m={key:1},g={key:2,class:"has-text-dark"},f={key:3,class:"has-text-dark"},h={key:1,class:"sequence-progress-background"},b=["alt","src"],v=["innerHTML"],y={key:1,class:"help is-danger"},k={class:"document-process-state"},_={key:0,class:"icon has-text-success loading-icon","aria-hidden":"true"},x={key:1,class:"icon has-text-success"},I={key:2,class:"document-actions"},w=["onClick"],L={class:"footer"},C={class:"form-submission-footer field is-grouped form-submit"},E={class:"control"},$={style:{"margin-inline-start":"auto"},class:"control"},F=["disabled"],S={class:"control"},j=["disabled"],O={key:2,class:"section"},A={class:"content has-text-dark has-text-centered"};function X(e,t,n,o,X,q){var P=(0,a.g2)("b-loading"),Q=(0,a.g2)("tainacan-title"),T=(0,a.g2)("b-upload"),M=(0,a.g2)("b-field"),D=(0,a.gN)("tooltip");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(P,{modelValue:X.isLoading,"onUpdate:modelValue":t[0]||(t[0]=function(e){return X.isLoading=e}),"is-full-page":!1,"can-cancel":!1},null,8,["modelValue"]),e.$adminOptions.hideBulkEditionPageTitle?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(Q,{key:0,"is-sticky":!0})),!X.isLoading&&e.collection&&e.collection.current_user_can_bulk_edit?((0,a.uX)(),(0,a.CE)("form",r,[(0,a.bF)(M,{addons:!1},{default:(0,a.k6)((function(){return[(0,a.Lk)("label",c,(0,a.v_)(e.$i18n.get("label_documents_upload")),1),t[7]||(t[7]=(0,a.Lk)("br",null,null,-1)),(0,a.bF)(T,{modelValue:X.submitedFileList,"onUpdate:modelValue":[t[1]||(t[1]=function(e){return X.submitedFileList=e}),t[2]||(t[2]=function(e){return q.uploadFiles()})],native:"","drag-drop":"",multiple:"",class:"source-file-upload"},{default:(0,a.k6)((function(){return[(0,a.Lk)("section",l,[(0,a.Lk)("div",s,[t[6]||(t[6]=(0,a.Lk)("p",null,[(0,a.Lk)("span",{"aria-hidden":"true",class:"icon"},[(0,a.Lk)("i",{class:"tainacan-icon tainacan-icon-30px tainacan-icon-upload"})])],-1)),(0,a.Lk)("p",null,(0,a.v_)(e.$i18n.get("instruction_drop_file_or_click_to_upload")),1)])])]})),_:1},8,["modelValue"])]})),_:1}),(0,a.Lk)("div",d,[(0,a.Lk)("div",u,[X.uploadedItems.length>0&&X.uploadedItems.length!=X.amountFinished?((0,a.uX)(),(0,a.CE)("p",p,[t[8]||(t[8]=(0,a.Lk)("span",{"aria-hidden":"true",class:"icon is-small has-text-secondary"},[(0,a.Lk)("i",{class:"tainacan-icon tainacan-icon-18px tainacan-icon-updating"})],-1)),(0,a.eW)(" "+(0,a.v_)(e.$i18n.get("label_upload_file_prepare_items")),1)])):(0,a.Q3)("",!0),X.uploadedItems.length>0&&X.uploadedItems.length==X.amountFinished?((0,a.uX)(),(0,a.CE)("p",m,[t[9]||(t[9]=(0,a.Lk)("span",{"aria-hidden":"true",class:"icon is-small has-text-success"},[(0,a.Lk)("i",{class:"tainacan-icon tainacan-icon-18px tainacan-icon-approvedcircle"})],-1)),(0,a.eW)(" "+(0,a.v_)(e.$i18n.get("label_process_completed")),1)])):(0,a.Q3)("",!0),X.uploadedItems.length>0&&X.uploadedItems.length-X.amountFinished>1?((0,a.uX)(),(0,a.CE)("p",g,(0,a.v_)(e.$i18n.getWithVariables("label_%s_files_remaining",[X.uploadedItems.length-X.amountFinished])),1)):(0,a.Q3)("",!0),X.uploadedItems.length>0&&X.uploadedItems.length-X.amountFinished==1?((0,a.uX)(),(0,a.CE)("p",f,(0,a.v_)(e.$i18n.get("label_one_file_remaining")),1)):(0,a.Q3)("",!0)]),X.uploadedItems.length>0?((0,a.uX)(),(0,a.CE)("div",{key:0,style:(0,a.Tr)({width:X.amountFinished/X.uploadedItems.length*100+"%"}),class:"sequence-progress"},null,4)):(0,a.Q3)("",!0),X.uploadedItems.length>0?((0,a.uX)(),(0,a.CE)("div",h)):(0,a.Q3)("",!0),(0,a.bF)(a.F,{name:"item-appear"},{default:(0,a.k6)((function(){return[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(X.uploadedItems,(function(n,o){return(0,a.uX)(),(0,a.CE)("div",{key:n.id,class:"document-item"},[null!=n.document&&""!=n.document&&"empty"!=n.document_type?((0,a.uX)(),(0,a.CE)("img",{key:0,class:"document-thumb",alt:e.$i18n.get("label_thumbnail")+": "+n.title,src:e.$thumbHelper.getSrc(n.thumbnail,"tainacan-small",n.document_mimetype)},null,8,b)):(0,a.Q3)("",!0),(0,a.Lk)("span",{class:"document-name",innerHTML:n.title},null,8,v),null!=n.errorMessage?((0,a.uX)(),(0,a.CE)("span",y,(0,a.v_)(n.errorMessage),1)):(0,a.Q3)("",!0),(0,a.Lk)("div",k,[null!=n.errorMessage||""!=n.document&&"empty"!=n.document_type?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",_,i(t[10]||(t[10]=[(0,a.Lk)("div",{class:"control has-icons-right is-loading is-clearfix"},null,-1)])))),""!=n.document&&"empty"!=n.document_type?(0,a.bo)(((0,a.uX)(),(0,a.CE)("span",x,i(t[11]||(t[11]=[(0,a.Lk)("i",{class:"tainacan-icon tainacan-icon-1-25em tainacan-icon-approvedcircle"},null,-1)])))),[[D,{delay:{show:500,hide:300},content:e.$i18n.get("label_document_uploaded"),autoHide:!1,placement:"auto-start",popperClass:["tainacan-tooltip","tooltip"]}]]):(0,a.Q3)("",!0)]),""!=n.document&&"empty"!=n.document_type?((0,a.uX)(),(0,a.CE)("div",I,[(0,a.bo)(((0,a.uX)(),(0,a.CE)("span",{class:"icon has-text-secondary action-icon",onClick:function(e){return q.deleteOneItem(n.id,o)}},i(t[12]||(t[12]=[(0,a.Lk)("i",{class:"tainacan-icon tainacan-icon-18px tainacan-icon-delete"},null,-1)])),8,w)),[[D,{delay:{show:500,hide:300},content:e.$i18n.get("label_button_delete_document"),autoHide:!1,placement:"auto-start",popperClass:["tainacan-tooltip","tooltip"]}]])])):(0,a.Q3)("",!0)])})),128))]})),_:1})]),(0,a.Lk)("footer",L,[(0,a.Lk)("div",C,[(0,a.Lk)("div",E,[(0,a.Lk)("button",{type:"button",class:"button is-outlined",onClick:t[3]||(t[3]=(0,a.D$)((function(t){return e.$router.go(-1)}),["prevent"]))},(0,a.v_)(e.$i18n.get("cancel")),1)]),(0,a.Lk)("div",$,[(0,a.Lk)("button",{disabled:!(X.uploadedItems.length>0&&X.uploadedItems.length==X.amountFinished),class:(0,a.C4)(["button is-secondary",{"is-loading":X.isCreatingSequenceEditGroup}]),type:"submit",onClick:t[4]||(t[4]=(0,a.D$)((function(e){return q.sequenceEditGroup()}),["prevent"]))},(0,a.v_)(e.$i18n.get("label_sequence_edit_items")),11,F)]),(0,a.Lk)("div",S,[(0,a.Lk)("button",{disabled:!(X.uploadedItems.length>0&&X.uploadedItems.length==X.amountFinished),class:"button is-secondary",type:"submit",onClick:t[5]||(t[5]=(0,a.D$)((function(e){return q.openBulkEditionModal()}),["prevent"]))},(0,a.v_)(e.$i18n.get("label_bulk_edit_items")),9,j)])])])])):X.isLoading||!e.collection||e.collection.current_user_can_bulk_edit?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("section",O,[(0,a.Lk)("div",A,[t[13]||(t[13]=(0,a.Lk)("p",null,[(0,a.Lk)("span",{class:"icon"},[(0,a.Lk)("i",{class:"tainacan-icon tainacan-icon-30px tainacan-icon-collection"})])],-1)),(0,a.Lk)("p",null,(0,a.v_)(e.$i18n.get("info_can_not_bulk_edit_items_collection")),1)])]))])}},66275(e,t,n){n.d(t,{A:()=>a.A});var a=n(67598)},67598(e,t,n){n.d(t,{A:()=>p});var a=n(40834),i=n(3012),o=n(19741);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var _n=0,a=function(){};return{s:a,n:function(){return _n>=e.length?{done:!0}:{done:!1,value:e[_n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){r=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(r)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const p={name:"ItemBulkEditionForm",data:function(){return{collectionId:"",isLoading:!1,isCreatingSequenceEditGroup:!1,submitedFileList:[],uploadedItems:[],amountFinished:0}},computed:d({},(0,a.L8)("collection",{collection:"getCollection"})),created:function(){this.collectionId=this.$route.params.collectionId,this.cleanFiles()},methods:d(d(d(d({},(0,a.i0)("collection",["sendFile","cleanFiles","deleteItem"])),(0,a.i0)("item",["sendItem","updateItemDocument"])),(0,a.i0)("bulkedition",["createSequenceEditGroup"])),{},{uploadFiles:function(){var e,t=this,n=c(this.submitedFileList);try{var a=function(){var n=e.value,a={collection_id:t.collectionId,status:"draft",title:n.name};t.sendItem(a).then((function(e){var a=t.uploadedItems.findIndex((function(t){return t.id===e.id}));a>=0?Object.assign(t.uploadedItems,u({},a,e)):t.uploadedItems.push(e),t.sendFile({itemId:e.id,file:n}).then((function(n){t.updateItemDocument({item_id:e.id,document:new String(n.id),document_type:"attachment"}).then((function(e){t.amountFinished++;var n=t.uploadedItems.findIndex((function(t){return t.id===e.id}));n>=0?Object.assign(t.uploadedItems,u({},n,e)):t.uploadedItems.unshift(e)})).catch((function(e){t.$console.error(e)}))})).catch((function(a){var i=t.uploadedItems.findIndex((function(t){return t.id===e.id}));i>=0&&t.uploadedItems.splice(i,1),e.errorMessage=a.data&&a.data.message?a.data.message:t.$i18n.get("info_error_upload"),t.$buefy.toast.open({message:e.errorMessage+": "+n.name,type:"is-danger",position:"is-bottom",duration:3500}),t.$console.error(a)}))})).catch((function(e){t.$console.error(e)}))};for(n.s();!(e=n.n()).done;)a()}catch(e){n.e(e)}finally{n.f()}},sequenceEditGroup:function(){var e=this,t=this.uploadedItems.map((function(e){return e.id}));this.isCreatingSequenceEditGroup=!0,this.createSequenceEditGroup({object:t,collectionId:this.collectionId}).then((function(t){var n=t.id;e.isCreatingSequenceEditGroup=!1,e.$router.push(e.$routerHelper.getCollectionSequenceEditPath(e.collectionId,n,1))}))},openBulkEditionModal:function(){var e=this.uploadedItems.map((function(e){return e.id}));this.$buefy.modal.open({component:o.default,props:{modalTitle:this.$i18n.get("info_editing_items_in_bulk"),totalItems:e.length,selectedForBulk:e,objectType:this.$i18n.get("items"),collectionId:this.collectionId},width:"calc(100% - (2 * var(--tainacan-one-column)))",trapFocus:!0,customClass:"tainacan-modal",canCancel:["escape","outside"]})},deleteOneItem:function(e,t){var n=this;this.$buefy.modal.open({component:i.default,props:{icon:"alert",title:this.$i18n.get("label_warning"),message:this.isOnTrash?this.$i18n.get("info_warning_item_delete"):this.$i18n.get("info_warning_item_trash"),onConfirm:function(){n.deleteItem({itemId:e}).then((function(){n.uploadedItems.splice(t,1),n.amountFinished--}))}},trapFocus:!0,customClass:"tainacan-modal",canCancel:["escape","outside"]})}})}},70811(e,t,n){n(73332)},73332(e,t,n){var a=n(85072),i=n.n(a),o=n(97825),r=n.n(o),c=n(77659),l=n.n(c),s=n(55056),d=n.n(s),u=n(10540),p=n.n(u),m=n(63494),g=n.n(m),f=n(94847),h={};h.styleTagTransform=g(),h.setAttributes=d(),h.insert=l().bind(null,"head"),h.domAPI=r(),h.insertStyleElement=p();i()(f.A,h),f.A&&f.A.locals&&f.A.locals},94847(e,t,n){n.d(t,{A:()=>c});var a=n(31601),i=n.n(a),o=n(76314),r=n.n(o)()(i());r.push([e.id,'.page-container>.tainacan-form[data-v-e83c1d70]{margin-bottom:56px}.page-container .source-file-upload[data-v-e83c1d70]{width:100%;padding:.75em var(--tainacan-one-column);flex-wrap:wrap;display:flex;display:grid}.page-container .document-list[data-v-e83c1d70]{display:inline-block;width:100%;padding:1em calc(2*var(--tainacan-one-column))}.page-container .document-list .document-item[data-v-e83c1d70]{display:flex;flex-wrap:nowrap;width:100%;justify-content:space-between;align-items:center;padding:.5em .75em;position:relative;cursor:default}.page-container .document-list .document-item .document-thumb[data-v-e83c1d70]{max-height:42px;max-width:42px;margin-inline-end:1em}.page-container .document-list .document-item .document-name[data-v-e83c1d70]{text-overflow:ellipsis;overflow:hidden;width:100%;white-space:nowrap}.page-container .document-list .document-item .document-process-state[data-v-e83c1d70]{margin-inline-start:auto}.page-container .document-list .document-item .document-process-state .loading-icon .control.is-loading[data-v-e83c1d70]::after{position:relative !important;right:0;top:0}.page-container .document-list .document-item .document-actions[data-v-e83c1d70]{position:absolute;inset-inline-end:0;background:var(--tainacan-gray2);height:100%;display:none;justify-content:center;visibility:hidden;align-items:center;width:42px}.page-container .document-list .document-item .document-actions .icon[data-v-e83c1d70]{cursor:pointer}.page-container .document-list .document-item[data-v-e83c1d70]:hover{background-color:var(--tainacan-gray1)}.page-container .document-list .document-item:hover .document-actions[data-v-e83c1d70]{display:flex;visibility:visible}.page-container .document-list .document-item .help.is-danger[data-v-e83c1d70]{margin-inline-end:auto;width:100%;text-align:end}.page-container .document-list .sequence-progress-info[data-v-e83c1d70]{display:flex;justify-content:space-between;margin-bottom:.25em}.page-container .document-list .sequence-progress-info .i[data-v-e83c1d70]::before{font-size:1.125em;margin-left:.5em}.page-container .document-list .sequence-progress[data-v-e83c1d70]{height:5px;background:var(--tainacan-turquoise5);width:0%;transition:width .2s;margin-bottom:1em}.page-container .document-list .sequence-progress-background[data-v-e83c1d70]{height:5px;background:var(--tainacan-gray3);width:100%;top:-21px;z-index:-1;position:relative;margin-bottom:1em}.page-container .footer[data-v-e83c1d70]{padding:10px var(--tainacan-one-column);position:absolute;bottom:0;z-index:999999;background-color:var(--tainacan-gray1);width:100%;height:3.5rem;display:flex;justify-content:flex-end;align-items:center;left:0;box-shadow:0px 0px 12px -8px var(--tainacan-black)}.page-container .footer[data-v-e83c1d70]::after,.page-container .footer[data-v-e83c1d70]::before{height:18px;width:18px;background:rgba(0,0,0,0);display:block;content:"";position:absolute}.page-container .footer[data-v-e83c1d70]::before{left:0;top:-18px;border-bottom-left-radius:9px;box-shadow:-9px 0px 0 0 var(--tainacan-gray1),inset 2px -2px 5px -3px var(--tainacan-gray2)}.page-container .footer[data-v-e83c1d70]::after{right:0;top:-18px;border-bottom-right-radius:9px;box-shadow:9px 0px 0 0 var(--tainacan-gray1),inset -2px -2px 5px -3px var(--tainacan-gray2)}@media screen and (max-width: 768px){.page-container .tainacan-form[data-v-e83c1d70]{padding-bottom:6rem}.page-container .footer[data-v-e83c1d70]{padding:13px .5em;margin-left:0;width:100%;flex-wrap:wrap;height:auto;position:fixed}}',""]);const c=r}}]);