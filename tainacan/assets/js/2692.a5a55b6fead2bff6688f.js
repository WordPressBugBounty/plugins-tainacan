"use strict";(self.webpackChunktainacan=self.webpackChunktainacan||[]).push([[2692],{14344:(e,t,n)=>{n.d(t,{A:()=>p});var o=n(40834);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,l,a=[],c=!0,s=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(a.push(o.value),a.length!==t);c=!0);}catch(e){s=!0,r=e}finally{try{if(!c&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(s)throw r}}return a}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return a(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const p={name:"ImporterEditionForm",data:function(){return{importerId:Number,importer:null,isLoading:!1,isLoadingRun:!1,isLoadingUpload:!1,isFetchingCollections:!1,form:{},formErrorMessage:"",mappedCollection:{id:Number,mapping:{},total_items:Number},importerTypes:[],importerType:"",importerName:"",importerFile:null,importerSourceInfo:null,collections:[],collectionId:void 0,url:"",backgroundProcess:void 0}},created:function(){var e=this;this.importerType=this.$route.params.importerSlug,this.collectionId=this.$route.query.targetCollection,this.sessionId=this.$route.params.sessionId,null!=this.collectionId&&this.onSelectCollection(this.collectionId),this.fetchAvailableImporters().then((function(t){t[e.importerType]&&(e.importerName=t[e.importerType].name),e.$routerHelper.appendToPageTitle(e.importerName),wp.hooks.doAction("tainacan_navigation_path_updated",{currentRoute:e.$route,adminOptions:e.$adminOptions,parentEntity:{rootLink:"importers",name:e.importerName,defaultLink:"importers/".concat(e.importerType,"/edit"),label:e.$i18n.get("importers")}})})),null!=this.sessionId?this.loadImporter():this.createImporter()},methods:s(s(s({},(0,o.i0)("importer",["fetchAvailableImporters","fetchImporter","sendImporter","updateImporter","updateImporterFile","updateImporterURL","updateImporterOptions","fetchImporterSourceInfo","updateImporterCollection","runImporter"])),(0,o.i0)("collection",["fetchAllCollectionNames"])),{},{createImporter:function(){var e=this;this.isLoading=!0,this.sendImporter(this.importerType).then((function(t){e.sessionId=t.id,e.importer=JSON.parse(JSON.stringify(t)),e.form=e.importer.options,e.isLoading=!1,e.importer.manual_collection&&e.loadCollections()})).catch((function(t){return e.$console.error(t)}))},loadImporter:function(){var e=this;this.isLoading=!0,this.fetchImporter(this.sessionId).then((function(t){e.sessionId=t.id,e.importer=JSON.parse(JSON.stringify(t)),e.form=e.importer.options,e.isLoading=!1,e.importer.manual_collection&&e.loadCollections()})).catch((function(t){return e.$console.error(t)}))},cancelBack:function(){this.$router.go(-1)},onUploadFile:function(){var e=this;return new Promise((function(t,n){e.updateImporterFile({sessionId:e.sessionId,file:e.importerFile&&null!=e.importerFile.length&&e.importerFile.length>0?e.importerFile[0]:e.importerFile}).then((function(n){e.importer=n,t()})).catch((function(t){e.formErrorMessage=t.error_message,e.$console.error(t),n(t)}))}))},onInputURL:function(){var e=this;return new Promise((function(t,n){e.updateImporterURL({sessionId:e.sessionId,url:e.url}).then((function(n){e.importer=n,t()})).catch((function(t){e.formErrorMessage=t.error_message,e.$console.error(t),n(t)}))}))},onUpdateOptions:function(){var e=this;return new Promise((function(t,n){if(null!=e.importer.options_form&&null!=e.importer.options&&""!=e.importer.options_form){var o,r=document.getElementById("importerOptionsForm"),a={},c=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var _n=0,o=function(){};return{s:o,n:function(){return _n>=e.length?{done:!0}:{done:!1,value:e[_n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw r}}}}(new FormData(r).entries());try{for(c.s();!(o=c.n()).done;){var s=i(o.value,2),u=s[0],p=s[1];a[u]=p}}catch(e){c.e(e)}finally{c.f()}e.updateImporterOptions({sessionId:e.sessionId,options:a}).then((function(n){e.importer=n,t()})).catch((function(t){e.formErrorMessage=t.error_message,e.$console.log(t),n(t)}))}else t()}))},uploadSource:function(){var e=this;return this.isLoadingUpload=!0,new Promise((function(t,n){e.importer.accepts.file&&!e.importer.accepts.url?e.onUploadFile().then((function(){e.isLoadingUpload=!1,t()})).catch((function(t){e.isLoadingUpload=!1,e.$console.error(t)})):!e.importer.accepts.file&&e.importer.accepts.url?e.onInputURL().then((function(){e.isLoadingUpload=!1,t()})).catch((function(t){e.isLoadingUpload=!1,e.$console.log(t)})):e.importer.accepts.file&&e.importer.accepts.url?e.importerFile?e.onUploadFile().then((function(){e.isLoadingUpload=!1,t()})).catch((function(t){e.isLoadingUpload=!1,e.$console.log(t)})):e.url?e.onInputURL().then((function(){e.isLoadingUpload=!1,t()})).catch((function(t){e.isLoadingUpload=!1,e.$console.log(t)})):(e.isLoadingUpload=!1,n("No source file given")):(e.isLoadingUpload=!1,t())}))},onFinishImporter:function(){var e=this;this.isLoadingRun=!0,this.onUpdateOptions().then((function(){e.uploadSource().then((function(){e.importer.manual_mapping?(e.goToMappingPage(),e.isLoadingRun=!1):e.onRunImporter()})).catch((function(t){e.isLoadingRun=!1,e.$console.log(t)}))})).catch((function(t){e.isLoadingRun=!1,e.$console.log(t)}))},onRunImporter:function(){var e=this;this.runImporter(this.sessionId).then((function(t){e.backgroundProcess=t,e.isLoadingRun=!1,e.$router.push(e.$routerHelper.getProcessesPath(t.bg_process_id))})).catch((function(t){e.isLoadingRun=!1,e.$console.log(t)}))},goToMappingPage:function(){this.$router.push(this.$routerHelper.getImporterMappingPath(this.importerType,this.sessionId,this.collectionId))},loadCollections:function(){var e=this;this.isFetchingCollections=!0,this.fetchAllCollectionNames().then((function(t){t.request.then((function(t){e.collections=Array.isArray(t)?t.filter((function(e){return e.current_user_can_edit_items})):[],e.isFetchingCollections=!1})).catch((function(t){e.$console.error(t),e.isFetchingCollections=!1}))})).catch((function(){e.isFetchingCollections=!1}))},onSelectCollection:function(e){this.collectionId=e,this.mappedCollection.id=e}})}},27113:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(31601),r=n.n(o),i=n(76314),l=n.n(i)()(r());l.push([e.id,".tainacan-form>.columns[data-v-436bc38d]{padding-top:var(--tainacan-container-padding)}.field[data-v-436bc38d]{position:relative}.form-submit[data-v-436bc38d]{margin-top:24px}.section-label[data-v-436bc38d]{font-size:1em !important;font-weight:500 !important;color:var(--tainacan-blue5) !important;line-height:1.2em}.source-metadatum[data-v-436bc38d]{padding:2px 0;border-bottom:1px solid var(--tainacan-gray2);width:100%;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}.is-inline .control[data-v-436bc38d]{display:inline}.drop-inner[data-v-436bc38d]{padding:.25em .5em}.mapping-header-label[data-v-436bc38d]{color:var(--tainacan-info-color);margin:12px 0 6px 0}.tainacan-modal .animation-content[data-v-436bc38d]{width:100%;z-index:99999}.tainacan-modal .animation-content #metadatumEditForm[data-v-436bc38d]{background-color:var(--tainacan-background-color)}.source-file-upload[data-v-436bc38d]{width:100%;flex-wrap:wrap;display:flex;display:grid}.selected-source-file[data-v-436bc38d]{border:1px solid var(--tainacan-gray2);padding:calc(.375em - 1px) 10px !important;font-size:.875em;line-height:1.5em;display:flex;justify-content:space-between;align-items:center}hr[data-v-436bc38d]{margin:.5em 0 1.5em 0}",""]);const a=l},29048:(e,t,n)=>{var o=n(85072),r=n.n(o),i=n(97825),l=n.n(i),a=n(77659),c=n.n(a),s=n(55056),u=n.n(s),p=n(10540),m=n.n(p),d=n(63494),f=n.n(d),g=n(27113),h={};h.styleTagTransform=f(),h.setAttributes=u(),h.insert=c().bind(null,"head"),h.domAPI=l(),h.insertStyleElement=m();r()(g.A,h),g.A&&g.A.locals&&g.A.locals},32692:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var o=n(66579),r=n(79439);n(32893);const i=(0,n(66262).A)(r.A,[["render",o.X],["__scopeId","data-v-436bc38d"]])},32893:(e,t,n)=>{n(29048)},66579:(e,t,n)=>{n.d(t,{X:()=>o.X});var o=n(76392)},76392:(e,t,n)=>{n.d(t,{X:()=>O});var o=n(6934);function r(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var l={class:"tainacan-repository-level-colors page-container"},a={key:0,class:"is-italic has-text-weight-semibold"},c={key:0,class:"columns"},s={class:"column"},u={class:"label"},p={class:"drop-inner"},m={class:"content has-text-centered"},d={key:1,class:"control selected-source-file"},f={class:"icon"},g={key:2,class:"control selected-source-file"},h={key:0,style:{"margin-top":"2em"},class:"column is-narrow is-hidden-mobile"},b={key:1,class:"column"},y={class:"is-inline"},v=["value"],_={key:1},k={key:2},I={id:"importerOptionsForm"},L=["innerHTML"],F={class:"columns is-gapless field is-grouped form-submit"},$={class:"control"},C={class:"help is-danger"},w={key:0,class:"control"},E=["disabled"],S={key:1,class:"control"},A=["disabled"];function O(e,t,n,i,O,U){var x=(0,o.g2)("tainacan-title"),P=(0,o.g2)("help-button"),j=(0,o.g2)("b-upload"),X=(0,o.g2)("b-field"),T=(0,o.g2)("b-input"),N=(0,o.g2)("b-select"),M=(0,o.g2)("router-link"),R=(0,o.g2)("b-loading"),Q=(0,o.gN)("tooltip");return(0,o.uX)(),(0,o.CE)("div",l,[(0,o.bF)(x,{"is-sticky":!0},{default:(0,o.k6)((function(){return[(0,o.Lk)("h1",null,[(0,o.eW)((0,o.v_)(e.$i18n.get("title_importer_page"))+" ",1),O.importerName?((0,o.uX)(),(0,o.CE)("span",a,(0,o.v_)(O.importerName),1)):(0,o.Q3)("",!0)])]})),_:1}),null!=O.importer&&null!=O.importer?((0,o.uX)(),(0,o.CE)("form",{key:0,class:"tainacan-form","label-width":"120px",onClick:t[7]||(t[7]=function(e){return O.formErrorMessage=""})},[O.importer.manual_collection||O.importer.accepts.file||O.importer.accepts.url?((0,o.uX)(),(0,o.CE)("div",c,[(0,o.Lk)("div",s,[O.importer.accepts.file?((0,o.uX)(),(0,o.Wv)(X,{key:0,addons:!1},{default:(0,o.k6)((function(){return[(0,o.Lk)("label",u,(0,o.v_)(e.$i18n.get("label_source_file")),1),(0,o.bF)(P,{title:e.$i18n.get("label_source_file"),message:e.$i18n.get("info_source_file_upload"),"extra-classes":"tainacan-repository-tooltip"},null,8,["title","message"]),t[11]||(t[11]=(0,o.Lk)("br",null,null,-1)),null!=O.importer.tmp_file||null!=O.importerFile&&null!=O.importerFile&&""!=O.importerFile?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(j,{key:0,modelValue:O.importerFile,"onUpdate:modelValue":t[0]||(t[0]=function(e){return O.importerFile=e}),"drag-drop":"",class:"source-file-upload"},{default:(0,o.k6)((function(){return[(0,o.Lk)("section",p,[(0,o.Lk)("div",m,[t[9]||(t[9]=(0,o.Lk)("p",null,[(0,o.Lk)("span",{class:"icon"},[(0,o.Lk)("i",{class:"tainacan-icon tainacan-icon-36px tainacan-icon-upload"})])],-1)),(0,o.Lk)("p",null,(0,o.v_)(e.$i18n.get("instruction_drop_file_or_click_to_upload")),1)])])]})),_:1},8,["modelValue"])),null!=O.importerFile?((0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("span",null,(0,o.v_)(null!=O.importerFile.length&&O.importerFile.length>0?O.importerFile[0].name:O.importerFile.name),1),(0,o.Lk)("a",{target:"_blank",onClick:t[1]||(t[1]=(0,o.D$)((function(e){return O.importerFile=void 0}),["prevent"]))},[(0,o.bo)(((0,o.uX)(),(0,o.CE)("span",f,r(t[10]||(t[10]=[(0,o.Lk)("i",{class:"tainacan-icon tainacan-icon-18px tainacan-icon-close"},null,-1)])))),[[Q,{content:e.$i18n.get("remove_value"),autoHide:!0,placement:"bottom",popperClass:["tainacan-tooltip","tooltip","tainacan-repository-tooltip"]}]])])])):(0,o.Q3)("",!0),null==O.importerFile&&O.importer.tmp_file?((0,o.uX)(),(0,o.CE)("div",g,[(0,o.Lk)("p",null,(0,o.v_)(e.$i18n.get("label_select_file")+": "+O.importer.tmp_file),1)])):(0,o.Q3)("",!0)]})),_:1})):(0,o.Q3)("",!0),O.importer.accepts.url?((0,o.uX)(),(0,o.Wv)(X,{key:1,addons:!1,label:e.$i18n.get("label_url_source_link")},{default:(0,o.k6)((function(){return[(0,o.bF)(P,{title:e.$i18n.get("label_url_source_link"),message:e.$i18n.get("info_url_source_link_helper"),"extra-classes":"tainacan-repository-tooltip"},null,8,["title","message"]),(0,o.bF)(T,{id:"tainacan-url-link-source",modelValue:O.url,"onUpdate:modelValue":t[2]||(t[2]=function(e){return O.url=e})},null,8,["modelValue"])]})),_:1},8,["label"])):(0,o.Q3)("",!0)]),O.importer.manual_collection?((0,o.uX)(),(0,o.CE)("div",h,r(t[12]||(t[12]=[(0,o.Lk)("span",{class:"icon"},[(0,o.Lk)("i",{class:"tainacan-icon tainacan-icon-pointer tainacan-icon-36px has-text-grey"})],-1)])))):(0,o.Q3)("",!0),O.importer.manual_collection?((0,o.uX)(),(0,o.CE)("div",b,[(0,o.bF)(X,{addons:!1,label:e.$i18n.get("label_target_collection")},{default:(0,o.k6)((function(){return[(0,o.bF)(P,{title:e.$i18n.get("label_target_collection"),message:e.$i18n.get("info_target_collection_helper"),"extra-classes":"tainacan-repository-tooltip"},null,8,["title","message"]),t[14]||(t[14]=(0,o.Lk)("br",null,null,-1)),(0,o.Lk)("div",y,[(0,o.bF)(N,{id:"tainacan-select-target-collection",expanded:"","model-value":O.collectionId,loading:O.isFetchingCollections,placeholder:e.$i18n.get("instruction_select_a_target_collection"),"onUpdate:modelValue":t[3]||(t[3]=function(e){return U.onSelectCollection(e)})},{default:(0,o.k6)((function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(O.collections,(function(e){return(0,o.uX)(),(0,o.CE)("option",{key:e.id,value:e.id},(0,o.v_)(e.name),9,v)})),128))]})),_:1},8,["model-value","loading","placeholder"]),e.$userCaps.hasCapability("tnc_rep_edit_collections")?((0,o.uX)(),(0,o.Wv)(M,{key:0,style:{"font-size":"0.875em"},class:"add-link",to:{path:e.$routerHelper.getNewCollectionPath(),query:{fromImporter:!0}}},{default:(0,o.k6)((function(){return[t[13]||(t[13]=(0,o.Lk)("span",{class:"icon"},[(0,o.Lk)("i",{class:"tainacan-icon tainacan-icon-add"})],-1)),(0,o.eW)(" "+(0,o.v_)(e.$i18n.get("new_blank_collection")),1)]})),_:1},8,["to"])):(0,o.Q3)("",!0)])]})),_:1},8,["label"])])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),(O.importer.manual_collection||O.importer.accepts.file||O.importer.accepts.url)&&null!=O.importer.options_form&&null!=O.importer.options_form&&""!=O.importer.options_form?((0,o.uX)(),(0,o.CE)("hr",_)):(0,o.Q3)("",!0),null!=O.importer.options_form&&null!=O.importer.options_form&&""!=O.importer.options_form?((0,o.uX)(),(0,o.CE)("div",k,[(0,o.Lk)("form",I,[(0,o.Lk)("div",{innerHTML:O.importer.options_form},null,8,L)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",F,[(0,o.Lk)("div",$,[(0,o.Lk)("button",{id:"button-cancel-importer-creation",class:"button is-outlined",type:"button",onClick:t[4]||(t[4]=function(){return U.cancelBack&&U.cancelBack.apply(U,arguments)})},(0,o.v_)(e.$i18n.get("cancel")),1)]),(0,o.Lk)("span",C,(0,o.v_)(O.formErrorMessage),1),O.importer.manual_mapping?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",w,[(0,o.Lk)("button",{id:"button-submit-importer-creation",disabled:null!=O.formErrorMessage&&""!=O.formErrorMessage||null==e.sessionId||null==O.importer||O.importer.manual_collection&&null==O.collectionId||O.importer.accepts.file&&!O.importer.accepts.url&&!O.importerFile||!O.importer.accepts.file&&O.importer.accepts.url&&!O.url||O.importer.accepts.file&&O.importer.accepts.url&&!O.importerFile&&!O.url,class:(0,o.C4)([{"is-loading":O.isLoadingRun,"is-success":!O.isLoadingRun},"button"]),onClick:t[5]||(t[5]=(0,o.D$)((function(e){return U.onFinishImporter()}),["prevent"]))},(0,o.v_)(e.$i18n.get("run")),11,E)])),O.importer.manual_mapping?((0,o.uX)(),(0,o.CE)("div",S,[(0,o.Lk)("button",{id:"button-submit-collection-creation",disabled:null!=O.formErrorMessage&&""!=O.formErrorMessage||null==e.sessionId||null==O.importer||O.importer.manual_collection&&null==O.collectionId||O.importer.accepts.file&&!O.importer.accepts.url&&!O.importerFile||!O.importer.accepts.file&&O.importer.accepts.url&&!O.url||O.importer.accepts.file&&O.importer.accepts.url&&!O.importerFile&&!O.url,class:(0,o.C4)([{"is-loading":O.isLoadingUpload,"is-success":!O.isLoadingUpload},"button"]),onClick:t[6]||(t[6]=(0,o.D$)((function(e){return U.onFinishImporter()}),["prevent"]))},(0,o.v_)(e.$i18n.get("next")),11,A)])):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),(0,o.bF)(R,{modelValue:O.isLoading,"onUpdate:modelValue":t[8]||(t[8]=function(e){return O.isLoading=e}),"can-cancel":!1},null,8,["modelValue"])])}},79439:(e,t,n)=>{n.d(t,{A:()=>o.A});var o=n(14344)}}]);